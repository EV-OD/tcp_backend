{% extends "base.html" %} {% block content %} {% load static %}
<link rel="stylesheet" href="{% static 'report.css' %}" />
<div class="form-container">
  {% csrf_token %}
  <label for="ip">IP Address:</label><br />
  <input type="text" id="ip" name="ip" required /><br />
  <label for="comment">Comment:</label><br />
  <textarea id="comment" name="comment" required></textarea><br />
  <label for="image">Upload image:</label><br />
  <input type="file" id="image" name="image" /><br />
  <input type="button" value="Submit" />
</div>
<script>
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie("csrftoken");

  let auth = "{{request.user.is_authenticated}}";
  const button = document.querySelector("input[type=button]");
  button.addEventListener("click", () => {
    const ipElt = document.querySelector("input[type=text]");
    const commentElt = document.querySelector("textarea");
    // const imageElt = document.querySelector("input[type=file]");

    const ip = ipElt.value;
    const comment = commentElt.value;
    if (auth == "True") {
      fetch("/setauthflag/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrftoken,
        },
        mode: "same-origin",
        body: JSON.stringify({ ip }),
      });
    } else {
      let user_ip = "{{request.user}}";
      fetch("/setpublicflag/", {
        method: "POST",
        headers: {
          "X-CSRFToken": csrftoken,

          "Content-Type": "application/json",
        },
        mode: "same-origin",

        body: JSON.stringify({ ip }),
      });
    }

    // const image = imageElt.files[0];
  });
</script>
{% endblock %}
