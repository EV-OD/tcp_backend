{% extends "base.html" %} {% block content %} {% load static %}
<link rel="stylesheet" href="{% static 'search.css' %}" />
<script defer src="{% static 'js/search.js' %}"></script>

<div class="center_container">
  <div class="form_wrapper">
    <div class="search_form">
      <!-- <h3>TCP Portal</h3> -->
      <div class="ip_form">
        <input type="text" id="ip" name="ip" value="{{ ip }}" required /><br />
        <input type="submit" value="Search" />
      </div>
    </div>
    <div class="row">
      <div class="column">
        <h2>Our Database</h2>
        <!-- {{flag}} -->
        <p>IP: {{flag.overall_ip}}</p>
        <p>Auth Flag Count: {{flag.authflag_count}}</p>
        <p>Public Flag Count: {{flag.publicflag_count}}</p>
        <p>Auto Flag Count: {{flag.autoflag_count}}</p>
      </div>
    </div>
  </div>
</div>
<script>
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie("csrftoken");

  let auth = "{{request.user.is_authenticated}}";
  const button = document.querySelector("input[type=button]");
  button.addEventListener("click", () => {
    const ipElt = document.querySelector("input[type=text]");
    const commentElt = document.querySelector("textarea");
    // const imageElt = document.querySelector("input[type=file]");

    const ip = ipElt.value;
    const comment = commentElt.value;
    if (auth == "True") {
      fetch("/setauthflag/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrftoken,
        },
        mode: "same-origin",
        body: JSON.stringify({ ip }),
      });
    } else {
      let user_ip = "{{request.user}}";
      fetch("/setpublicflag/", {
        method: "POST",
        headers: {
          "X-CSRFToken": csrftoken,

          "Content-Type": "application/json",
        },
        mode: "same-origin",

        body: JSON.stringify({ ip }),
      });
    }

    // const image = imageElt.files[0];
  });
</script>

{% endblock %}
